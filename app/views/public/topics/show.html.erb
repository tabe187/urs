<head>
</head>

<main>
  <div class="container">
    <div class="row border-bottom">
      <div class="col-lg-2 ">
          <% if @topic.topic_image.attached? %>
        <div class="flex-item">
          <div class="image-wrap">
            <%= image_tag  @topic.get_topic_image(100,100) %>
          </div>
        </div>
          <% else %>
        <div class="flex-item">
          <div class="image-wrap">
            <%= image_tag 'no_image', size: "100x100" %>
          </div>
        </div>
          <% end %>
      </div>

      <div class="col-lg-5 d-flex align-items-end">
        <h5><%= @topic.title %>(<%= @topic.community.title %>コミュニティ)</h5><br>
      </div>
      <div class="col d-flex align-items-end justify-content-end">
          <p class="caption">
            <% if @topic.community.participated_by?(current_user) %>
             <%= link_to community_participant_path(@topic.community), method: :delete, class: "btn-sm btn-secondary"  do %>
              参加中
             <% end %>
            <% else %>
             <%= link_to community_participants_path(@topic.community), method: :post, class:'btn btn-sm btn-success' do %>
              コミュニティに参加する
             <% end %>
            <% end %>
          </p>
      </div>
    </div>
    <div class="row justify-content-center " >
        トピック
    </div>

    <div class="row border justify-content-center" style="padding:10px; margin:10px; ">
       <div class="col-mid-1 d-flex align-items-end text-center" >
         <div class="flex-item">
            <div class="image-wrap_profile">
                <% if @topic.user.profile_image.attached? %>
                  <%= link_to user_path(@topic.user_id)  do %>
                     <%= image_tag @topic.user.get_profile_image(80,80) %><br>
                  <% end %><br>
                <% else %>
                  <%= link_to user_path(@topic.user_id)  do %>
                     <%= image_tag 'no_image', size: "50x50" %><br>
                  <% end %><br>
                <% end %>
                  <%= @topic.user.name %>
            </div>
         </div>
       </div>
       <div class="col-md-5 offset-md-1">
          <div class="row d-flex align-items-end justify-content-end ">
             投稿日:<%= @topic.created_at.strftime('%Y/%m/%d') %><br>
          </div>
             <%= @topic.explanation %>
       </div>
    </div>
          <div class="row justify-content-center" >
              コメント一覧(<%= @topic.comments.count %>件)
          </div>
  <div class="container border">
                   <% @topic.comments.each do |comment| %>
        <div class="row justify-content-center" style="padding:10px; margin:10px; ">           
            <div class="col-mid-1">       
                    <div class="flex-item">
                      <div class="image-wrap_comment_user">
                      <% if comment.user.profile_image.attached? %>
                        <%= link_to user_path(comment.user_id)  do %>
                           <%= image_tag comment.user.get_profile_image(80,80) %><br>
                        <% end %><br>
                      <% else %>
                        <%= link_to user_path(comment.user_id)  do %>
                           <%= image_tag 'no_image', size: "50x50" %><br>
                        <% end %><br>
                      <% end %>
                      <%= link_to comment.user.name, user_path(comment.user.id) %>
                      </div>
                    </div>
            </div>        
            <div class="col-md-5 offset-md-1">      
                    <div class="row d-flex align-items-end justify-content-end">
                      投稿日:<%= comment.created_at.strftime('%Y/%m/%d') %>
                    </div>
                    <div class="row">
                      <%= comment.comment %>
                    </div>
            </div>
          </div>  
          <div class="row justify-content-center text-center ">
            <div class="flex-item">
              <div class="image-wrap_comment">
                  <% if comment.comment_image.attached? %>
                       <%= image_tag comment.get_comment_image(50,50) %>
                  <% end %>
              </div>
            </div>
          </div>
          <div class="row border-bottom"></div>
        <% end %>  
  </div>
</div>
    <div class="row justify-content-center" >
                <%= form_with model: @comment, url: community_comments_path, local: true do |f| %>
                
                  <label>コメントを投稿する</label>

                <div class="form-group">
                  <%= f.text_area :comment ,  class: 'form-control',size: "60x10" %>
                </div>
 
                <div class="form-group">
                  <%= f.file_field :comment_image, accept: "image/*" %>
                </div>

                  <%= f.hidden_field :topic_id, :value => @topic.id %>
                <div class="actions">
                  <%= f.submit 'コメントする', class: "btn btn-success" do %>
                  <% end %>
                </div>
                <% end %>

    </div>
  </div>
</main>

