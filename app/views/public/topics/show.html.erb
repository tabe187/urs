<head>
</head>

<main>
  <div class="container">
    <div class="row border-bottom">
      <div class="col-lg-2 ">
          <% if @topic.topic_image.attached? %>
        <div class="flex-item">
          <div class="image-wrap">
            <%= image_tag  @topic.get_topic_image(100,100) %>
          </div>
        </div>
          <% else %>
        <div class="flex-item">
          <div class="image-wrap">
            <%= image_tag 'no_image', size: "100x100" %>
          </div>
        </div>
          <% end %>
      </div>

      <div class="col-lg-5 d-flex align-items-end">
        <h5><%= @topic.title %>(<%= @topic.community.title %>コミュニティ)</h5><br>
      </div>
      <div class="col d-flex align-items-end justify-content-end">
        <% if user_signed_in? %>
          <p class="caption">
            <% if @topic.community.participated_by?(current_user) %>
             <%= link_to community_participant_path(@topic.community), method: :delete, class: "btn-sm btn-secondary"  do %>
              参加中
             <% end %>
            <% else %>
             <%= link_to community_participants_path(@topic.community), method: :post, class:'btn btn-sm btn-success' do %>
              コミュニティに参加する
             <% end %>
            <% end %>
          </p>
        <% end %>
        <% if !user_signed_in? %>
           <%= link_to new_user_session_path, class:'btn btn-sm btn-success' do %>
            コミュニティに参加する
           <% end %>
        <% end %>
      </div>
    </div>
    <div class="row justify-content-center " >
        <h4><%= @topic.title %></h4>
    </div>

    <div class="row justify-content-center" style="padding:10px; margin:10px; ">
       <div class="col-md-1 d-flex align-items-end text-center" style="padding:10px;" >
         <div class="flex-item">
            <div class="image-wrap_profile">
                <% if @topic.user.profile_image.attached? %>
                  <%= link_to user_path(@topic.user_id)  do %>
                     <%= image_tag @topic.user.get_profile_image(80,80) %><br>
                  <% end %><br>
                <% else %>
                  <%= link_to user_path(@topic.user_id)  do %>
                     <%= image_tag 'no_image', size: "50x50" %><br>
                  <% end %><br>
                <% end %>
                  <%= @topic.user.name %>
            </div>
         </div>
       </div>
       <div class="col-md-5 offset-md-1">
          <div class="row d-flex align-items-end justify-content-end ">
             投稿日:<%= @topic.created_at.strftime('%Y/%m/%d') %><br>
          </div>
             <%= @topic.explanation %>
       </div>
       <div class="row d-flex align-items-end justify-content-end">
          <% if user_signed_in? %>   
            <% if @topic.user_id == current_user.id %>
             <%= link_to "トピック内容を編集する", edit_community_topic_path(@topic.community.id, @topic.id) %><br>
            <% end %>
          <% end %>  
       </div>
    </div>
    <div class="row justify-content-center border-bottom" >
        コメント一覧(<%= @topic.comments.count %>件)
    </div>
    <div class="container">
          <% @topic.comments.each do |comment| %>
          <div class="row justify-content-center " style="padding:10px; margin:10px; ">           
              <div class="col-mid-1">       
                  <div class="flex-item">
                    <div class="image-wrap_comment_user">
                    <% if comment.user.profile_image.attached? %>
                      <%= link_to user_path(comment.user_id)  do %>
                         <%= image_tag comment.user.get_profile_image(80,80) %><br>
                      <% end %><br>
                    <% else %>
                      <%= link_to user_path(comment.user_id)  do %>
                         <%= image_tag 'no_image', size: "50x50" %><br>
                      <% end %><br>
                    <% end %>
                    <%= link_to comment.user.name, user_path(comment.user.id) %>
                    </div>
                  </div>
              </div>        
              <div class="col-md-5 offset-md-1">      
                    <div class="row d-flex align-items-end justify-content-end">
                      投稿日:<%= comment.created_at.strftime('%Y/%m/%d') %>
                      <div onClick='setting'>
                        <i class="fas fa-cog"></i>
                      </div>
                    </div>
                    <div class="row">
                      <%= comment.comment %>
                    </div>
              </div>
            </div>  
            <div class="row justify-content-center text-center ">
              <div class="flex-item">
                <div class="image-wrap_comment">
                    <% if comment.comment_image.attached? %>
                         <%= image_tag comment.get_comment_image(200,200) %>
                    <% end %>
                </div>
              </div>
            </div>
            <div class="row border-bottom"></div>
          <% end %>  
    </div>
    <% if user_signed_in? %>
      <div class="row justify-content-center" >
                  <%= form_with model: @comment, url: community_comments_path, local: true do |f| %>
                  
                    <label>コメントを投稿する</label>
  
                  <div class="form-group">
                    <%= f.text_area :comment ,  class: 'form-control',size: "60x10" %>
                  </div>
   
                  <div class="form-group">
                    <%= f.file_field :comment_image, accept: "image/*" %>
                  </div>
  
                    <%= f.hidden_field :topic_id, :value => @topic.id %>
                  <div class="actions">
                    <%= f.submit 'コメントする', class: "btn btn-success" do %>
                    <% end %>
                  </div>
                  <% end %>
      </div>
    <% end %>
    <div class="row justify-content-end">
      <% if user_signed_in? %>   
        <% if @topic.user_id == current_user.id %>
         <%= link_to "トピックを削除する", community_topic_path(@topic.community.id, @topic.id), method: :delete, class:"btn-sm btn-secondary", "data-confirm" => "本当に削除しますか？" %>
        <% end %>
      <% end %>
    </div>
  </div>  
</main>



<script>
  function setting {
      let settingWindow = [];
      
          settingWindow[i] = new google.maps.InfoWindow({
                    // contentで中身を指定
                    // 今回は文字にリンクを貼り付けた形で表示
                    content: `<a href='/maps/${maps[i].id}'>${maps[i].place_name}</a>`
                    });

       }

</script>


